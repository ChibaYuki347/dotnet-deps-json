# deps.json とは何か

## 概要

`deps.json`ファイルは、.NET Core/.NET 5+アプリケーションの**依存関係管理システム**の中核となるファイルです。このファイルは、アプリケーションが実行時に必要とするすべての依存関係の詳細な情報を含んでいます。

## 主な役割

### 1. 依存関係の解決
- アプリケーションが必要とするNuGetパッケージの正確なバージョン
- プロジェクト間の参照関係
- フレームワーク固有の依存関係

### 2. ランタイムアセンブリの特定
- 実行時にロードする必要があるアセンブリファイル
- プラットフォーム固有のネイティブライブラリ
- リソースファイルの場所

### 3. パフォーマンスの最適化
- アセンブリ検索の高速化
- 不要なファイルスキャンの削減
- メモリ使用量の最適化

## ファイル構造

```json
{
  "runtimeTarget": {
    "name": ".NETCoreApp,Version=v8.0",
    "signature": ""
  },
  "compilationOptions": {},
  "targets": {
    ".NETCoreApp,Version=v8.0": {
      // ターゲットフレームワーク固有の依存関係
    }
  },
  "libraries": {
    // すべてのライブラリの詳細情報
  },
  "runtimeTarget": {
    // ランタイム固有の情報
  }
}
```

### 主要セクション

#### `runtimeTarget`
- 対象となるランタイムフレームワーク
- プラットフォーム固有の情報

#### `targets`
- フレームワークターゲット別の依存関係
- 条件付きの依存関係

#### `libraries`
- すべての依存ライブラリの詳細
- パッケージの種類（NuGet/プロジェクト参照）
- バージョン情報とハッシュ値

## 生成タイミング

### 開発時
- `dotnet build` 実行時に基本版が生成
- デバッグ用の簡易版

### 配布時
- `dotnet publish` 実行時に完全版が生成
- 本番環境用の最適化版
- Self-contained deploymentでは特に重要

## 実用的な効果

### 1. 高速なアプリケーション起動
- 事前に依存関係が解決済み
- ファイルシステムの探索が不要

### 2. 確実な依存関係管理
- バージョン競合の回避
- 欠損ファイルの早期検出

### 3. セキュリティの向上
- ハッシュ値による整合性チェック
- 予期しないファイルの実行防止

## 関連ファイル

- `*.runtimeconfig.json`: ランタイム設定
- `*.dll`: アプリケーションアセンブリ
- `*.pdb`: デバッグ情報
- NuGetパッケージファイル群

## トラブルシューティング

### よくある問題
1. **FileNotFoundExceptionが発生**
   - deps.jsonに記載されているファイルが見つからない
   - パッケージの復元不完全

2. **バージョン競合エラー**
   - 異なるバージョンの同一パッケージが参照されている
   - 推移的依存関係の競合

3. **プラットフォーム固有の問題**
   - ネイティブライブラリのアーキテクチャ不一致
   - 対象フレームワークの不整合

### 解決方法
```bash
# パッケージの完全復元
dotnet restore --force

# 依存関係ツリーの確認
dotnet list package --include-transitive

# 特定のパッケージの詳細確認
dotnet list package --vulnerable
```
